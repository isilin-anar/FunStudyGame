<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="파이썬을 누구나 쉽고 무료로 배울 수 있는 학습 플랫폼. 기초부터 심화까지 단계별 학습과 타이핑 게임을 제공합니다.">
    <meta name="keywords" content="파이썬, Python, 코딩, 무료학습, 프로그래밍, 코딩교육">
    <meta property="og:title" content="PYTHON MATRIX - 무료 파이썬 학습 플랫폼">
    <meta property="og:description" content="파이썬 코딩의 모든 것을 매트릭스처럼 배우세요. 완전 무료!">
    <meta property="og:type" content="website">
    <title>PYTHON MATRIX - 무료 파이썬 학습</title>
    <!-- Google AdSense 연결 시 아래 주석을 해제하고 ca-pub ID를 입력하세요 -->
    <!-- <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX" crossorigin="anonymous"></script> -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #0f0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* 커스텀 스크롤바 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #000;
        }
        ::-webkit-scrollbar-thumb {
            background: #0f0;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #0a0;
        }

        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .code-rain {
            position: absolute;
            color: #0f0;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            text-shadow: 0 0 5px #0f0;
            top: -100%;
        }

        .hidden {
            display: none !important;
        }

        /* ===== 인트로 화면 ===== */
        #introScreen {
            text-align: center;
            z-index: 100;
        }

        .intro-title {
            font-size: 4rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 20px #0f0, 0 0 40px #0f0;
            letter-spacing: 0.1em;
        }

        .intro-subtitle {
            font-size: 1.2rem;
            color: #0f0;
            margin-bottom: 0.5rem;
            opacity: 0.8;
        }

        .intro-typing {
            font-size: 1rem;
            color: #0ff;
            margin-bottom: 2rem;
            min-height: 1.5em;
        }

        .intro-typing .cursor {
            animation: blink 0.7s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        .intro-badge {
            display: inline-block;
            background: rgba(0, 255, 0, 0.15);
            border: 1px solid #0f0;
            border-radius: 20px;
            padding: 4px 14px;
            font-size: 0.85rem;
            margin-bottom: 1.5rem;
            color: #0f0;
        }

        /* ===== 공통 버튼 ===== */
        .button {
            background: transparent;
            border: 2px solid #0f0;
            color: #0f0;
            padding: 12px 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            margin: 10px;
            display: inline-block;
            min-width: 150px;
            border-radius: 5px;
        }

        .button:hover, .button:focus {
            background: #0f0;
            color: #000;
            box-shadow: 0 0 15px #0f0;
            transform: scale(1.05);
            outline: none;
        }

        .button-primary {
            background: rgba(0, 255, 0, 0.15);
            font-size: 1.2rem;
            padding: 15px 40px;
            min-width: 200px;
        }

        .button-small {
            padding: 8px 16px;
            font-size: 14px;
            min-width: auto;
            margin: 5px;
        }

        /* ===== 단계 선택 화면 ===== */
        .stage-select {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #0f0;
            border-radius: 10px;
            padding: 2rem;
            max-width: 700px;
            width: 95%;
            margin: 0 auto;
            max-height: 90vh;
            overflow-y: auto;
        }

        .stage-title {
            font-size: 2rem;
            margin-bottom: 1.5rem;
            text-align: center;
            text-shadow: 0 0 10px #0f0;
        }

        .stage-item {
            border: 1px solid #0f0;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .stage-item:hover, .stage-item:focus {
            background: rgba(0, 255, 0, 0.1);
            box-shadow: 0 0 10px #0f0;
            outline: none;
        }

        .stage-item h3 {
            margin-bottom: 5px;
        }

        .stage-item p {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .stage-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: bold;
        }

        .badge-complete {
            background: rgba(0, 255, 0, 0.3);
            border: 1px solid #0f0;
            color: #0f0;
        }

        .badge-locked {
            background: rgba(255, 255, 0, 0.2);
            border: 1px solid #ff0;
            color: #ff0;
        }

        /* ===== 학습 화면 ===== */
        .learning-container {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #0f0;
            border-radius: 10px;
            padding: 2rem;
            max-width: 1000px;
            width: 95%;
            margin: 0 auto;
            max-height: 90vh;
            overflow-y: auto;
        }

        /* 진행률 바 */
        .progress-bar {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 25px;
            gap: 0;
        }

        .progress-step {
            display: flex;
            align-items: center;
            font-size: 0.85rem;
            color: #555;
            transition: color 0.3s;
        }

        .progress-step.active {
            color: #0f0;
            text-shadow: 0 0 5px #0f0;
        }

        .progress-step.done {
            color: #0a0;
        }

        .progress-dot {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid #555;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
            margin-right: 5px;
            transition: all 0.3s;
        }

        .progress-step.active .progress-dot {
            border-color: #0f0;
            background: rgba(0, 255, 0, 0.2);
            box-shadow: 0 0 8px #0f0;
        }

        .progress-step.done .progress-dot {
            border-color: #0a0;
            background: rgba(0, 255, 0, 0.3);
        }

        .progress-line {
            width: 40px;
            height: 2px;
            background: #555;
            margin: 0 8px;
        }

        .progress-line.done {
            background: #0a0;
        }

        .step-content {
            min-height: 300px;
        }

        .theory-box {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid #0f0;
            border-radius: 5px;
            padding: 20px;
            margin: 20px 0;
        }

        .code-input {
            background: #111;
            border: 2px solid #0f0;
            color: #0f0;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            width: 100%;
            border-radius: 5px;
            min-height: 100px;
            resize: vertical;
        }

        .code-input:focus {
            outline: none;
            box-shadow: 0 0 10px #0f0;
        }

        .code-output {
            background: #000;
            border: 2px solid #0f0;
            color: #0f0;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            width: 100%;
            min-height: 80px;
            border-radius: 5px;
            white-space: pre-wrap;
        }

        .quiz-option {
            display: block;
            margin: 10px 0;
            padding: 10px 15px;
            border: 1px solid #0f0;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quiz-option:hover {
            background: rgba(0, 255, 0, 0.1);
        }

        .quiz-option input[type="radio"] {
            margin-right: 10px;
        }

        /* ===== 게임 화면 ===== */
        .game-container {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #0f0;
            border-radius: 10px;
            padding: 20px;
            max-width: 1200px;
            width: 95%;
            margin: 0 auto;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #0f0;
            flex-wrap: wrap;
            gap: 10px;
        }

        .game-title {
            font-size: 1.5rem;
            font-weight: bold;
            text-shadow: 0 0 10px #0f0;
        }

        .game-stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .stat {
            color: #0f0;
            font-size: 1rem;
            font-weight: bold;
        }

        .stat-combo {
            color: #ff0;
        }

        .game-area {
            position: relative;
            height: 450px;
            background: #000;
            border: 2px solid #0f0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .game-instructions {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #0f0;
            padding: 30px;
            background: rgba(0, 255, 0, 0.1);
            border: 2px solid #0f0;
            border-radius: 10px;
            max-width: 90%;
            width: 500px;
        }

        .falling-code {
            position: absolute;
            background: rgba(0, 255, 0, 0.1);
            border: 2px solid #0f0;
            border-radius: 5px;
            padding: 12px;
            min-width: 200px;
            max-width: 280px;
            text-align: center;
            font-size: 14px;
            transition: background 0.2s, border-color 0.2s;
        }

        .code-text {
            color: #0f0;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            margin-bottom: 6px;
            font-size: 16px;
            line-height: 1.3;
            word-break: break-all;
            white-space: pre-wrap;
        }

        .code-translation {
            color: #ff0;
            font-size: 12px;
            line-height: 1.3;
        }

        .game-input-wrap {
            position: relative;
        }

        .game-input {
            width: 100%;
            background: #111;
            border: 2px solid #0f0;
            color: #0f0;
            padding: 12px 15px;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            border-radius: 5px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .game-input:focus {
            outline: none;
            box-shadow: 0 0 10px #0f0;
        }

        .game-input.input-wrong {
            border-color: #f00;
            box-shadow: 0 0 10px #f00;
            animation: shake 0.3s;
        }

        .game-input.input-correct {
            border-color: #0f0;
            box-shadow: 0 0 15px #0f0;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .difficulty-options {
            margin: 15px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .difficulty-options label {
            display: inline-block;
            margin: 4px;
            padding: 6px 12px;
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid #0f0;
            border-radius: 5px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }

        .difficulty-options label:hover {
            background: rgba(0, 255, 0, 0.2);
        }

        .difficulty-options input[type="radio"] {
            margin-right: 6px;
        }

        .success {
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid #0f0;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
        }

        .error {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid #f00;
            color: #f00;
            padding: 15px;
            border-radius: 5px;
        }

        /* 점수 팝업 */
        .score-popup {
            position: absolute;
            color: #0f0;
            font-size: 1.5rem;
            font-weight: bold;
            text-shadow: 0 0 10px #0f0;
            pointer-events: none;
            animation: scoreUp 0.8s ease-out forwards;
            z-index: 100;
        }

        @keyframes scoreUp {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-60px) scale(1.5); }
        }

        /* 게임 종료 화면 */
        .game-result {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #0f0;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            color: #0f0;
            z-index: 1000;
            min-width: 300px;
            max-width: 90%;
        }

        /* 낙하 애니메이션 */
        @keyframes fall {
            from { top: -100px; }
            to { top: 100%; }
        }

        /* ===== 반응형 ===== */
        @media (max-width: 768px) {
            .intro-title {
                font-size: 2.5rem;
            }
            .intro-subtitle {
                font-size: 1rem;
            }
            .stage-select {
                padding: 1.2rem;
            }
            .stage-title {
                font-size: 1.5rem;
            }
            .learning-container {
                padding: 1.2rem;
            }
            .game-container {
                padding: 12px;
            }
            .game-title {
                font-size: 1.2rem;
            }
            .game-area {
                height: 350px;
            }
            .game-instructions {
                padding: 20px;
            }
            .falling-code {
                min-width: 160px;
                max-width: 200px;
                padding: 8px;
            }
            .code-text {
                font-size: 13px;
            }
            .code-translation {
                font-size: 11px;
            }
            .button {
                padding: 10px 18px;
                font-size: 14px;
                min-width: 120px;
            }
            .progress-line {
                width: 20px;
            }
            .progress-step span {
                display: none;
            }
        }

        @media (max-width: 480px) {
            .intro-title {
                font-size: 2rem;
            }
            .game-area {
                height: 280px;
            }
            .falling-code {
                min-width: 130px;
                max-width: 160px;
                padding: 6px;
            }
            .code-text {
                font-size: 11px;
            }
            .game-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="matrix-bg" id="matrixBg"></div>

    <!-- ===== 인트로 화면 ===== -->
    <div id="introScreen">
        <div style="text-align: center; z-index: 100; padding: 20px;">
            <div class="intro-badge">100% 무료</div>
            <h1 class="intro-title">PYTHON MATRIX</h1>
            <p class="intro-subtitle">파이썬 코딩의 모든 것을 매트릭스처럼 배우세요</p>
            <div class="intro-typing" id="introTyping"><span class="cursor">|</span></div>
            <div>
                <button class="button button-primary" onclick="goToStageSelect()">학습 시작하기</button>
            </div>
            <p style="font-size: 0.8rem; opacity: 0.5; margin-top: 1rem;">서버 비용을 위해 광고가 포함될 수 있습니다</p>
        </div>
    </div>

    <!-- ===== 단계 선택 화면 ===== -->
    <div id="stageScreen" class="hidden">
        <div class="stage-select">
            <h2 class="stage-title">학습 단계 선택</h2>

            <div class="stage-item" tabindex="0" role="button" onclick="selectStage(1)" onkeydown="if(event.key==='Enter')selectStage(1)">
                <span class="stage-badge badge-complete" id="badge-stage1" style="display:none;">완료</span>
                <h3>단계 1: 파이썬 기초 - 변수와 자료형</h3>
                <p>변수 선언, 정수, 문자열, 불리언 등 기본 자료형 학습</p>
            </div>

            <div class="stage-item" tabindex="0" role="button" onclick="selectStage(2)" onkeydown="if(event.key==='Enter')selectStage(2)">
                <span class="stage-badge badge-locked" id="badge-stage2">준비중</span>
                <h3>단계 2: 리스트와 반복문</h3>
                <p>리스트 생성, for 반복문으로 데이터 처리하기</p>
            </div>

            <div class="stage-item" tabindex="0" role="button" onclick="selectStage(3)" onkeydown="if(event.key==='Enter')selectStage(3)">
                <span class="stage-badge badge-locked" id="badge-stage3">준비중</span>
                <h3>단계 3: 조건문과 함수</h3>
                <p>if 조건문, def 함수로 구조화된 프로그램 만들기</p>
            </div>

            <div class="stage-item" tabindex="0" role="button" onclick="selectStage('game')" onkeydown="if(event.key==='Enter')selectStage('game')">
                <h3>코드 낙하 게임</h3>
                <p>파이썬 코드를 타이핑하는 3분 타이머 게임</p>
            </div>

            <div style="text-align: center; margin-top: 1.5rem;">
                <button class="button" onclick="goToIntro()">뒤로 가기</button>
            </div>
        </div>
    </div>

    <!-- ===== 학습 화면 ===== -->
    <div id="learningScreen" class="hidden">
        <div class="learning-container">
            <!-- 진행률 표시 -->
            <div class="progress-bar" id="progressBar">
                <div class="progress-step active" id="prog-theory">
                    <div class="progress-dot">1</div>
                    <span>이론</span>
                </div>
                <div class="progress-line" id="prog-line1"></div>
                <div class="progress-step" id="prog-quiz">
                    <div class="progress-dot">2</div>
                    <span>퀴즈</span>
                </div>
                <div class="progress-line" id="prog-line2"></div>
                <div class="progress-step" id="prog-coding">
                    <div class="progress-dot">3</div>
                    <span>실습</span>
                </div>
            </div>

            <!-- 1. 이론 -->
            <div id="step1" class="step-content">
                <h3 style="font-size: 1.5rem; margin-bottom: 20px; color: #0ff;">이론 학습</h3>
                <div class="theory-box">
                    <h4 style="color: #0ff; margin-bottom: 10px;">파이썬 변수란?</h4>
                    <p>변수는 데이터를 저장하는 공간입니다. 변수명으로 데이터를 저장하고 불러올 수 있습니다.</p>

                    <h4 style="color: #0ff; margin: 20px 0 10px;">변수 명명 규칙</h4>
                    <ul style="margin-left: 20px;">
                        <li>영문자, 숫자, 언더스코어(_) 사용 가능</li>
                        <li>숫자로 시작 불가</li>
                        <li>대소문자 구분</li>
                        <li>파이썬 예약어 사용 불가</li>
                    </ul>

                    <h4 style="color: #0ff; margin: 20px 0 10px;">주요 자료형</h4>
                    <div style="background: #111; padding: 15px; border-radius: 5px; margin: 10px 0;">
                        <p style="color: #0ff;">정수 (int):</p> <code>age = 25</code><br>
                        <p style="color: #0ff;">문자열 (str):</p> <code>name = '홍길동'</code><br>
                        <p style="color: #0ff;">불리언 (bool):</p> <code>is_student = True</code>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 2rem;">
                    <button class="button" onclick="showQuiz()">다음: 퀴즈</button>
                </div>
            </div>

            <!-- 2. 퀴즈 -->
            <div id="quiz" class="step-content hidden">
                <h3 style="font-size: 1.5rem; margin-bottom: 20px; color: #0ff;">퀴즈</h3>
                <div class="theory-box">
                    <p style="margin-bottom: 20px;"><strong>다음 중 올바른 변수 선언은?</strong></p>
                    <label class="quiz-option">
                        <input type="radio" name="answer" value="0"> var name = '홍길동'
                    </label>
                    <label class="quiz-option">
                        <input type="radio" name="answer" value="1"> name = '홍길동'
                    </label>
                    <label class="quiz-option">
                        <input type="radio" name="answer" value="2"> string name = '홍길동'
                    </label>

                    <div id="quizResult" style="margin-top: 20px;"></div>

                    <div style="text-align: center; margin-top: 2rem;">
                        <button class="button" onclick="checkQuiz()">정답 확인</button>
                        <button id="nextToCoding" class="button hidden" onclick="showCoding()">다음: 실습</button>
                    </div>
                </div>
            </div>

            <!-- 3. 코드 실습 -->
            <div id="coding" class="step-content hidden">
                <h3 style="font-size: 1.5rem; margin-bottom: 20px; color: #0ff;">코드 실습</h3>
                <div class="theory-box">
                    <p style="margin-bottom: 15px;"><strong>미션:</strong></p>
                    <p>변수 'my_name'에 당신의 이름을 저장하고 출력하는 코드를 작성하세요.</p>

                    <div style="margin-top: 20px;">
                        <label style="display: block; margin-bottom: 10px;">코드를 작성하세요 (Shift+Enter: 줄바꿈, Enter: 실행):</label>
                        <textarea id="codeInput" class="code-input" placeholder="여기에 코드를 작성하세요...&#10;my_name = '당신의이름'&#10;print(my_name)"></textarea>
                    </div>

                    <div style="margin-top: 20px;">
                        <label style="display: block; margin-bottom: 10px;">실행 결과:</label>
                        <div id="codeOutput" class="code-output">코드를 실행하면 결과가 여기에 표시됩니다.</div>
                    </div>

                    <div id="codeResult" style="margin-top: 20px;"></div>

                    <div style="text-align: center; margin-top: 2rem;">
                        <button class="button" onclick="runCode()">코드 실행</button>
                        <button class="button" onclick="showHint()">힌트 보기</button>
                        <button id="completeBtn" class="button hidden" onclick="completeStage()">단계 완료</button>
                    </div>

                    <div id="hintBox" style="margin-top: 20px; display: none;">
                        <div class="success">
                            <p>힌트:</p>
                            <code>my_name = '당신의이름'<br>print(my_name)</code>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div style="text-align: center; margin-top: 1rem; padding-bottom: 20px;">
            <button class="button" onclick="goBackToStageSelect()">뒤로 가기</button>
        </div>
    </div>

    <!-- ===== 코드 낙하 게임 화면 ===== -->
    <div id="gameScreen" class="hidden">
        <div class="game-container">
            <div class="game-header">
                <div class="game-title">코드 낙하 게임</div>
                <div class="game-stats">
                    <div class="stat">점수: <span id="score">0</span></div>
                    <div class="stat stat-combo">콤보: <span id="combo">0</span>x</div>
                    <div class="stat">시간: <span id="timer">3:00</span></div>
                </div>
            </div>

            <div class="game-area" id="gameArea">
                <div class="game-instructions" id="gameInstructions">
                    <h3>게임 규칙</h3>
                    <ul style="list-style: none; padding: 0; text-align: left; margin-top: 12px; font-size: 0.9rem;">
                        <li>- 화면 위에서 파이썬 코드가 내려옵니다</li>
                        <li>- 한국어 뜻을 보고 코드를 타이핑하세요</li>
                        <li>- 제한 시간은 3분입니다</li>
                        <li>- 바닥에 닿기 전에 정확히 타이핑하면 점수 획득</li>
                        <li>- 연속 정답 시 콤보 보너스!</li>
                    </ul>

                    <div class="difficulty-options">
                        <h4 style="color: #0ff;">난이도 선택</h4>
                        <label><input type="radio" name="difficulty" value="easy" checked> 초초보자 (40초)</label>
                        <label><input type="radio" name="difficulty" value="normal"> 초보자 (25초)</label>
                        <label><input type="radio" name="difficulty" value="hard"> 보통 (15초)</label>
                        <label><input type="radio" name="difficulty" value="extreme"> 어려움 (10초)</label>
                    </div>

                    <button class="button button-primary" onclick="startGame()">게임 시작</button>
                </div>
            </div>

            <div class="game-input-wrap">
                <input type="text" id="gameInput" class="game-input" placeholder="여기에 코드를 입력하고 엔터를 치세요..." disabled autocomplete="off" autocapitalize="off" spellcheck="false">
            </div>
        </div>

        <div style="text-align: center; margin-top: 1rem; padding-bottom: 20px;">
            <button class="button" onclick="goBackToStageSelect()">뒤로 가기</button>
        </div>
    </div>

    <script>
        // ===== 매트릭스 배경 =====
        function createMatrixRain() {
            const matrixBg = document.getElementById('matrixBg');
            const cols = Math.floor(window.innerWidth / 20);

            for (let i = 0; i < cols; i++) {
                const column = document.createElement('div');
                column.className = 'code-rain';
                column.style.left = i * 20 + 'px';

                let chars = '';
                for (let j = 0; j < 20; j++) {
                    const char = String.fromCharCode(33 + Math.floor(Math.random() * 94));
                    const opacity = 1 - (j / 20);
                    const color = j === 19 ? '#fff' : '#0f0';
                    chars += '<div style="opacity:' + opacity + ';color:' + color + ';">' + char + '</div>';
                }
                column.innerHTML = chars;
                const duration = 3 + Math.random() * 7;
                column.style.animation = 'fall ' + duration + 's linear infinite';
                column.style.animationDelay = -Math.random() * duration + 's';
                matrixBg.appendChild(column);
            }
        }

        // ===== 인트로 타이핑 애니메이션 =====
        const typingTexts = [
            'print("Hello, World!")',
            'for i in range(10):',
            'def learn_python():',
            'if dream == True:',
            '    never_give_up()'
        ];
        let typingIndex = 0;
        let charIndex = 0;
        let isDeleting = false;
        let typingTimer = null;

        function typeIntro() {
            const el = document.getElementById('introTyping');
            if (!el) return;

            const current = typingTexts[typingIndex];

            if (!isDeleting) {
                el.innerHTML = current.substring(0, charIndex + 1) + '<span class="cursor">|</span>';
                charIndex++;
                if (charIndex >= current.length) {
                    isDeleting = true;
                    typingTimer = setTimeout(typeIntro, 1500);
                    return;
                }
            } else {
                el.innerHTML = current.substring(0, charIndex) + '<span class="cursor">|</span>';
                charIndex--;
                if (charIndex < 0) {
                    isDeleting = false;
                    charIndex = 0;
                    typingIndex = (typingIndex + 1) % typingTexts.length;
                }
            }

            typingTimer = setTimeout(typeIntro, isDeleting ? 40 : 80);
        }

        // ===== localStorage 진행 상황 =====
        function getProgress() {
            try {
                return JSON.parse(localStorage.getItem('pythonMatrixProgress') || '{}');
            } catch {
                return {};
            }
        }

        function saveProgress(stage) {
            const progress = getProgress();
            progress['stage' + stage] = true;
            localStorage.setItem('pythonMatrixProgress', JSON.stringify(progress));
        }

        function updateStageBadges() {
            const progress = getProgress();
            for (let i = 1; i <= 3; i++) {
                const badge = document.getElementById('badge-stage' + i);
                if (badge && progress['stage' + i]) {
                    badge.textContent = '완료';
                    badge.className = 'stage-badge badge-complete';
                    badge.style.display = '';
                }
            }
        }

        // ===== 화면 전환 =====
        function goToStageSelect() {
            document.getElementById('introScreen').classList.add('hidden');
            document.getElementById('stageScreen').classList.remove('hidden');
            updateStageBadges();
        }

        function goToIntro() {
            document.getElementById('stageScreen').classList.add('hidden');
            document.getElementById('introScreen').classList.remove('hidden');
        }

        function goBackToStageSelect() {
            stopGame();
            document.getElementById('learningScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('stageScreen').classList.remove('hidden');
            updateStageBadges();
        }

        function selectStage(stage) {
            if (stage === 'game') {
                document.getElementById('stageScreen').classList.add('hidden');
                document.getElementById('gameScreen').classList.remove('hidden');
                initGame();
            } else if (stage === 1) {
                document.getElementById('stageScreen').classList.add('hidden');
                document.getElementById('learningScreen').classList.remove('hidden');
                initLearning();
            } else {
                alert('단계 ' + stage + ' 학습 기능은 준비 중입니다!');
            }
        }

        // ===== 학습 진행률 업데이트 =====
        function updateProgress(step) {
            const steps = ['theory', 'quiz', 'coding'];
            const activeIdx = steps.indexOf(step);

            steps.forEach(function(s, i) {
                const el = document.getElementById('prog-' + s);
                el.className = 'progress-step';
                if (i < activeIdx) el.classList.add('done');
                if (i === activeIdx) el.classList.add('active');
            });

            var line1 = document.getElementById('prog-line1');
            var line2 = document.getElementById('prog-line2');
            line1.className = activeIdx > 0 ? 'progress-line done' : 'progress-line';
            line2.className = activeIdx > 1 ? 'progress-line done' : 'progress-line';
        }

        // ===== 학습 기능 =====
        let learningInitialized = false;

        function initLearning() {
            // 학습 화면 초기 상태로 리셋
            document.getElementById('step1').classList.remove('hidden');
            document.getElementById('quiz').classList.add('hidden');
            document.getElementById('coding').classList.add('hidden');
            document.getElementById('quizResult').innerHTML = '';
            document.getElementById('nextToCoding').classList.add('hidden');
            document.getElementById('codeResult').innerHTML = '';
            document.getElementById('completeBtn').classList.add('hidden');
            document.getElementById('hintBox').style.display = 'none';
            document.getElementById('codeInput').value = '';
            document.getElementById('codeOutput').textContent = '코드를 실행하면 결과가 여기에 표시됩니다.';
            document.getElementById('codeOutput').style.color = '#0f0';

            // 라디오 버튼 초기화
            var radios = document.querySelectorAll('input[name="answer"]');
            radios.forEach(function(r) { r.checked = false; });

            updateProgress('theory');

            // 이벤트 리스너는 한 번만 등록
            if (!learningInitialized) {
                learningInitialized = true;
                document.getElementById('codeInput').addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        runCode();
                    }
                });
            }
        }

        function showQuiz() {
            document.getElementById('step1').classList.add('hidden');
            document.getElementById('quiz').classList.remove('hidden');
            updateProgress('quiz');
        }

        function checkQuiz() {
            var selected = document.querySelector('input[name="answer"]:checked');
            var resultEl = document.getElementById('quizResult');

            if (!selected) {
                alert('답변을 선택해주세요.');
                return;
            }

            if (parseInt(selected.value) === 1) {
                resultEl.className = 'success';
                resultEl.innerHTML = '정답입니다! 파이썬에서는 <code>변수명 = 값</code> 형식으로 변수를 선언합니다.';
                document.getElementById('nextToCoding').classList.remove('hidden');
            } else {
                resultEl.className = 'error';
                resultEl.innerHTML = '오답입니다. 파이썬은 다른 언어와 달리 타입 선언 키워드가 필요 없습니다. 다시 생각해보세요.';
            }
        }

        function showCoding() {
            document.getElementById('quiz').classList.add('hidden');
            document.getElementById('coding').classList.remove('hidden');
            document.getElementById('codeInput').focus();
            updateProgress('coding');
        }

        function runCode() {
            var code = document.getElementById('codeInput').value.trim();
            var resultEl = document.getElementById('codeResult');
            var outputEl = document.getElementById('codeOutput');

            if (!code) {
                outputEl.textContent = '코드를 입력해주세요.';
                outputEl.style.color = '#ff0';
                return;
            }

            // 간단한 파이썬 코드 시뮬레이터
            try {
                var lines = code.split('\n');
                var output = '';
                var variables = {};

                for (var idx = 0; idx < lines.length; idx++) {
                    var line = lines[idx].trim();
                    if (!line || line.startsWith('#')) continue;

                    // 변수 할당
                    var assignMatch = line.match(/^(\w+)\s*=\s*(.+)$/);
                    if (assignMatch) {
                        var val = assignMatch[2].trim();
                        // 문자열
                        if ((val.startsWith("'") && val.endsWith("'")) ||
                            (val.startsWith('"') && val.endsWith('"'))) {
                            val = val.slice(1, -1);
                        }
                        // 숫자
                        else if (!isNaN(val)) {
                            val = Number(val);
                        }
                        // 불리언
                        else if (val === 'True') val = true;
                        else if (val === 'False') val = false;
                        // 다른 변수 참조
                        else if (variables.hasOwnProperty(val)) {
                            val = variables[val];
                        }
                        variables[assignMatch[1]] = val;
                    }

                    // print() 처리
                    var printMatch = line.match(/^print\(\s*(.*)\s*\)$/);
                    if (printMatch) {
                        var content = printMatch[1].trim();
                        // 문자열 리터럴
                        if ((content.startsWith("'") && content.endsWith("'")) ||
                            (content.startsWith('"') && content.endsWith('"'))) {
                            content = content.slice(1, -1);
                        }
                        // 변수 참조
                        else if (variables.hasOwnProperty(content)) {
                            content = String(variables[content]);
                        }
                        // type() 호출
                        else if (content.startsWith('type(') && content.endsWith(')')) {
                            var typeArg = content.slice(5, -1).trim();
                            if (variables.hasOwnProperty(typeArg)) {
                                var v = variables[typeArg];
                                if (typeof v === 'number') content = "<class 'int'>";
                                else if (typeof v === 'string') content = "<class 'str'>";
                                else if (typeof v === 'boolean') content = "<class 'bool'>";
                                else content = "<class 'unknown'>";
                            }
                        }

                        if (output) output += '\n';
                        output += content;
                    }
                }

                if (output) {
                    outputEl.textContent = output;
                    outputEl.style.color = '#0f0';
                } else {
                    outputEl.textContent = '(출력 없음)';
                    outputEl.style.color = '#888';
                }
            } catch (err) {
                outputEl.textContent = '코드 실행 오류: ' + err.message;
                outputEl.style.color = '#f00';
            }

            // 미션 정답 확인
            var hasMyName = code.includes('my_name');
            var hasAssign = /my_name\s*=\s*['"].+['"]/.test(code);
            var hasPrint = /print\(\s*my_name\s*\)/.test(code);

            if (hasMyName && hasAssign && hasPrint) {
                resultEl.className = 'success';
                resultEl.innerHTML = '정답입니다! 완벽한 파이썬 문법입니다!';
                document.getElementById('completeBtn').classList.remove('hidden');
            } else {
                resultEl.className = 'error';
                var feedback = '힌트: ';
                if (!hasMyName) {
                    feedback += 'my_name 변수를 사용해보세요. ';
                } else if (!hasAssign) {
                    feedback += "문자열은 따옴표(' 또는 \")로 감싸야 합니다. ";
                }
                if (!hasPrint) {
                    feedback += 'print(my_name)으로 변수를 출력해보세요.';
                }
                resultEl.innerHTML = feedback;
            }
        }

        function showHint() {
            var hintBox = document.getElementById('hintBox');
            hintBox.style.display = hintBox.style.display === 'none' ? 'block' : 'none';
        }

        function completeStage() {
            saveProgress(1);
            alert('단계 1을 완료했습니다! 파이썬 변수와 자료형을 마스터했습니다.');
            goBackToStageSelect();
        }

        // ===== 게임 기능 =====
        var gameActive = false;
        var gameScore = 0;
        var gameTotal = 0;
        var gameCombo = 0;
        var gameBestCombo = 0;
        var gameTimeLeft = 180;
        var gameInterval = null;
        var timerInterval = null;
        var fallingCodes = [];
        var gameDifficulty = 'easy';
        var instructionsHTML = ''; // 게임 안내 HTML 백업

        var difficultySettings = {
            easy:    { speed: 40, spawnRate: 0.04, codeWidth: 240 },
            normal:  { speed: 25, spawnRate: 0.06, codeWidth: 240 },
            hard:    { speed: 15, spawnRate: 0.10, codeWidth: 220 },
            extreme: { speed: 10, spawnRate: 0.14, codeWidth: 200 }
        };

        var gameCodes = [
            { code: "print('Hello')", translation: "화면에 출력하다" },
            { code: "x = 10", translation: "변수 x에 10을 저장" },
            { code: "name = '홍길동'", translation: "변수에 이름 저장" },
            { code: "for i in range(5):", translation: "5번 반복하다" },
            { code: "if x > 5:", translation: "x가 5보다 크면" },
            { code: "def my_func():", translation: "내 함수 정의" },
            { code: "list.append(item)", translation: "리스트에 항목 추가" },
            { code: "len(my_list)", translation: "리스트 길이 구하기" },
            { code: "return value", translation: "값을 반환하다" },
            { code: "import random", translation: "랜덤 모듈 가져오기" },
            { code: "class Student:", translation: "학생 클래스 정의" },
            { code: "try:", translation: "시도해보다" },
            { code: "except:", translation: "예외 처리" },
            { code: "while True:", translation: "무한 반복" },
            { code: "dict['key']", translation: "딕셔너리 값 접근" },
            { code: "input('이름: ')", translation: "사용자 입력 받기" },
            { code: "x += 1", translation: "x에 1을 더하다" },
            { code: "elif x == 0:", translation: "아니면 x가 0이면" },
            { code: "break", translation: "반복문 빠져나가기" },
            { code: "continue", translation: "다음 반복으로 건너뛰기" }
        ];

        function initGame() {
            gameScore = 0;
            gameTotal = 0;
            gameCombo = 0;
            gameBestCombo = 0;
            gameTimeLeft = 180;
            fallingCodes = [];

            updateGameUI();

            // 게임 안내 HTML 백업 (최초 1회)
            if (!instructionsHTML) {
                var instrEl = document.getElementById('gameInstructions');
                if (instrEl) {
                    instructionsHTML = instrEl.outerHTML;
                }
            }
        }

        function startGame() {
            var selectedDifficulty = document.querySelector('input[name="difficulty"]:checked');
            gameDifficulty = selectedDifficulty ? selectedDifficulty.value : 'easy';

            gameActive = true;
            gameScore = 0;
            gameTotal = 0;
            gameCombo = 0;
            gameBestCombo = 0;
            gameTimeLeft = 180;
            fallingCodes = [];

            var instrEl = document.getElementById('gameInstructions');
            if (instrEl) instrEl.style.display = 'none';

            var gameInput = document.getElementById('gameInput');
            gameInput.disabled = false;
            gameInput.value = '';
            gameInput.focus();

            gameInput.onkeydown = function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    checkCode();
                }
            };

            updateGameUI();
            startGameLoop();
            startTimer();
        }

        function startGameLoop() {
            gameInterval = setInterval(function() {
                if (!gameActive) return;

                var settings = difficultySettings[gameDifficulty];
                if (Math.random() < settings.spawnRate) {
                    createFallingCode();
                }
            }, 100);
        }

        function createFallingCode() {
            var settings = difficultySettings[gameDifficulty];
            var codeWidth = settings.codeWidth;
            var position = getNonOverlappingPosition(codeWidth);
            if (!position) return;

            var randomCode = gameCodes[Math.floor(Math.random() * gameCodes.length)];
            var gameArea = document.getElementById('gameArea');

            var codeElement = document.createElement('div');
            codeElement.className = 'falling-code';
            codeElement.style.width = codeWidth + 'px';
            codeElement.style.left = position.x + 'px';
            codeElement.style.animation = 'fall ' + settings.speed + 's linear forwards';

            // 안전하게 텍스트 삽입 (XSS 방지)
            var codeTextEl = document.createElement('div');
            codeTextEl.className = 'code-text';
            codeTextEl.textContent = randomCode.code;

            var transEl = document.createElement('div');
            transEl.className = 'code-translation';
            transEl.textContent = randomCode.translation;

            codeElement.appendChild(codeTextEl);
            codeElement.appendChild(transEl);

            gameArea.appendChild(codeElement);

            var codeItem = {
                element: codeElement,
                code: randomCode.code,
                x: position.x
            };

            // 바닥 도달 시 제거
            var fallTimer = setTimeout(function() {
                if (codeElement.parentNode) {
                    codeElement.remove();
                }
                fallingCodes = fallingCodes.filter(function(item) { return item !== codeItem; });
            }, settings.speed * 1000);

            codeItem.timer = fallTimer;
            fallingCodes.push(codeItem);
            gameTotal++;
        }

        function getNonOverlappingPosition(codeWidth) {
            var gameArea = document.getElementById('gameArea');
            var areaWidth = gameArea.offsetWidth;
            var minGap = 30;
            var candidates = [];

            for (var x = 5; x <= areaWidth - codeWidth - 5; x += 20) {
                var canPlace = true;

                for (var j = 0; j < fallingCodes.length; j++) {
                    var existing = fallingCodes[j];
                    var existingWidth = difficultySettings[gameDifficulty].codeWidth;
                    var existingRight = existing.x + existingWidth;
                    var newRight = x + codeWidth;

                    if (x < existingRight + minGap && newRight > existing.x - minGap) {
                        canPlace = false;
                        break;
                    }
                }

                if (canPlace) {
                    candidates.push(x);
                }
            }

            if (candidates.length === 0) return null;
            return { x: candidates[Math.floor(Math.random() * candidates.length)] };
        }

        function checkCode() {
            var gameInput = document.getElementById('gameInput');
            var input = gameInput.value.trim();
            if (!input) return;

            var matchedIndex = -1;
            for (var i = 0; i < fallingCodes.length; i++) {
                if (fallingCodes[i].code === input) {
                    matchedIndex = i;
                    break;
                }
            }

            if (matchedIndex !== -1) {
                var matched = fallingCodes[matchedIndex];
                gameCombo++;
                if (gameCombo > gameBestCombo) gameBestCombo = gameCombo;

                // 콤보 보너스 점수
                var points = 1 + Math.floor(gameCombo / 3);
                gameScore += points;

                // 정답 시각 효과
                matched.element.style.background = 'rgba(0, 255, 0, 0.5)';
                matched.element.style.borderColor = '#0f0';

                // 점수 팝업
                showScorePopup(matched.element, '+' + points);

                clearTimeout(matched.timer);
                setTimeout(function() {
                    if (matched.element.parentNode) matched.element.remove();
                }, 200);

                fallingCodes.splice(matchedIndex, 1);

                gameInput.value = '';
                gameInput.className = 'game-input input-correct';
                setTimeout(function() { gameInput.className = 'game-input'; }, 300);

            } else {
                // 오답 시각 효과
                gameCombo = 0;
                gameInput.className = 'game-input input-wrong';
                setTimeout(function() { gameInput.className = 'game-input'; }, 300);
            }

            updateGameUI();
        }

        function showScorePopup(element, text) {
            var popup = document.createElement('div');
            popup.className = 'score-popup';
            popup.textContent = text;
            popup.style.left = element.style.left;
            popup.style.top = (element.offsetTop - 10) + 'px';
            document.getElementById('gameArea').appendChild(popup);
            setTimeout(function() { popup.remove(); }, 800);
        }

        function startTimer() {
            timerInterval = setInterval(function() {
                if (!gameActive) return;
                gameTimeLeft--;
                updateGameUI();
                if (gameTimeLeft <= 0) endGame();
            }, 1000);
        }

        function updateGameUI() {
            var minutes = Math.floor(gameTimeLeft / 60);
            var seconds = gameTimeLeft % 60;
            document.getElementById('timer').textContent = minutes + ':' + (seconds < 10 ? '0' : '') + seconds;
            document.getElementById('score').textContent = gameScore;
            document.getElementById('combo').textContent = gameCombo;
        }

        function endGame() {
            gameActive = false;
            clearInterval(gameInterval);
            clearInterval(timerInterval);

            // 남은 코드 제거
            fallingCodes.forEach(function(item) {
                clearTimeout(item.timer);
                if (item.element.parentNode) item.element.remove();
            });
            fallingCodes = [];

            var accuracy = gameTotal > 0 ? Math.round((gameScore / gameTotal) * 100) : 0;

            // 등급 산출
            var rank = 'F';
            if (accuracy >= 90) rank = 'S';
            else if (accuracy >= 80) rank = 'A';
            else if (accuracy >= 60) rank = 'B';
            else if (accuracy >= 40) rank = 'C';
            else if (accuracy >= 20) rank = 'D';

            var gameArea = document.getElementById('gameArea');

            var resultDiv = document.createElement('div');
            resultDiv.className = 'game-result';
            resultDiv.innerHTML =
                '<h3 style="font-size:2rem;margin-bottom:20px;">게임 종료!</h3>' +
                '<div style="font-size:2.5rem;margin:10px 0;color:#ff0;">등급: ' + rank + '</div>' +
                '<div style="font-size:1.2rem;margin:10px 0;">최종 점수: ' + gameScore + '</div>' +
                '<div style="font-size:1rem;margin:8px 0;">정확도: ' + accuracy + '% | 최대 콤보: ' + gameBestCombo + 'x</div>' +
                '<div style="margin-top:20px;">' +
                    '<button class="button" onclick="restartGame()">다시하기</button>' +
                '</div>';

            gameArea.appendChild(resultDiv);
            document.getElementById('gameInput').disabled = true;
        }

        function restartGame() {
            stopGame();

            var gameArea = document.getElementById('gameArea');
            // 게임 영역 정리 후 백업해둔 안내 HTML 복원
            gameArea.innerHTML = instructionsHTML;

            document.getElementById('gameInput').disabled = true;
            document.getElementById('gameInput').value = '';
            document.getElementById('gameInput').className = 'game-input';

            gameScore = 0;
            gameTotal = 0;
            gameCombo = 0;
            gameBestCombo = 0;
            gameTimeLeft = 180;
            updateGameUI();
        }

        function stopGame() {
            gameActive = false;
            if (gameInterval) { clearInterval(gameInterval); gameInterval = null; }
            if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }

            fallingCodes.forEach(function(item) {
                clearTimeout(item.timer);
                if (item.element.parentNode) item.element.remove();
            });
            fallingCodes = [];
        }

        // ===== 초기화 =====
        window.onload = function() {
            createMatrixRain();
            typeIntro();
        };

        var resizeTimer;
        window.onresize = function() {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(function() {
                document.getElementById('matrixBg').innerHTML = '';
                createMatrixRain();
            }, 300);
        };
    </script>
</body>
</html>
